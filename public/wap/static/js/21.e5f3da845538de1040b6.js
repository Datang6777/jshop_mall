webpackJsonp([21],{"4VUU":function(t,e){},"HeT/":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={props:{payments:{type:Array,default:function(){return[]}},money:{type:String,default:function(){return"0"}}},methods:{payment:function(t){this.$emit("pay",t)}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.payments.length?s("div",t._l(t.payments,function(e,a){return s("div",{key:a,staticClass:"payment",on:{click:function(i){return t.payment(e.code)}}},[s("img",{staticClass:"payment-img",attrs:{src:e.img}}),t._v(" "),s("div",{staticClass:"payment-left"},[s("h3",[t._v(t._s(e.name))]),t._v(" "),"balancepay"===e.code?s("p",[t._v("当前余额: "+t._s(t.money))]):s("p",[t._v(t._s(e.memo))])]),t._v(" "),s("img",{staticClass:"right-img",attrs:{src:i("oenc")}})])}),0):t._e()},staticRenderFns:[]};var n={components:{payment:i("C7Lr")(s,a,!1,function(t){i("Zw/p")},null,null).exports},data:function(){return{ids:this.$route.query.ids,type:this.$route.query.type||1,money:this.$route.query.recharge||0,order_amount:"",payments:[],userInfo:{},popShow:!1}},created:function(){var t=this;this.ids&&1==this.type?this.orderDetail():this.money&&2==this.type||this.$dialog.toast({mes:"订单支付参数错误",timeout:1300,callback:function(){t.$router.go(-1)}}),this.getUserInfo(),this.getPaymentType()},computed:{payType:{get:function(){},set:function(t){"weixin"===t&&(this.popShow=!0)}}},methods:{orderDetail:function(){var t=this;this.$api.orderDetail({order_id:this.ids},function(e){t.money=e.data.order_amount})},getPaymentType:function(){var t=this;this.$api.paymentList({},function(e){var i=e.data;t.GLOBAL.isWeiXinBrowser()&&(i=i.filter(function(t){return"alipay"!==t.code})),2==t.type&&(i=i.filter(function(t){return"balancepay"!==t.code&&1===t.is_online})),i.forEach(function(e){t.$set(e,"img","./static/image/"+e.code+".png")}),t.payments=i})},getUserInfo:function(){var t=this;this.$api.userInfo({},function(e){e.status&&(t.userInfo=e.data)})},pay:function(t){var e=this,i={ids:this.ids,payment_code:t,payment_type:this.type};"wechatpay"===t?this.GLOBAL.isWeiXinBrowser()?(1==this.type&&this.ids?i.params={trade_type:"JSAPI_OFFICIAL"}:2==this.type&&this.money&&(i.params={money:this.money}),this.$api.pay(i,function(t){if(t.status){var i=t.data,s=e;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:i.appid,timeStamp:i.timeStamp,nonceStr:i.nonceStr,package:i.package,signType:i.signType,paySign:i.paySign},function(t){"get_brand_wcpay_request:ok"===t.err_msg&&(1==s.type?s.$router.replace({path:"/payresult",query:{order_id:s.ids}}):2==s.type&&s.$router.replace({path:"/balance"}))})}})):(1==this.type&&this.ids?i.params={trade_type:"MWEB",return_url:this.GLOBAL.locationHost()+"/#/cashierdesk?ids="+this.ids+"&type="+this.type+"&pay_type=weixin"}:2==this.type&&this.money&&(i.params={trade_type:"MWEB",money:this.money,return_url:this.GLOBAL.locationHost()+"/#/cashierdesk?ids="+this.ids+"&type="+this.type+"&pay_type=weixin"}),this.$api.pay(i,function(t){t.status?(e.payType="weixin",location.href=t.data.mweb_url):e.$dialog.alert({mes:t.msg})})):"alipay"===t?(1==this.type&&this.ids?i.params={trade_type:"WAP",return_url:this.GLOBAL.locationHost()+"/#/payresult?order_id="+this.ids}:2==this.type&&this.money&&(i.params={money:this.money,return_url:this.GLOBAL.locationHost()+"/#/balance"}),this.$api.pay(i,function(t){t.status&&e.StandardPost(t.data.url,t.data.data)})):"balancepay"===t?this.$api.pay(i,function(t){t.status&&e.$router.replace({path:"/payresult",query:{order_id:e.ids}})}):"offline"===t&&this.$dialog.confirm({title:"线下支付说明",mes:"请联系客服进行线下支付",opts:[{txt:"订单详情",color:!1,callback:function(){e.$router.push({path:"/orderdetail",query:{order_id:e.ids}})}},{txt:"继续购物",color:!0,callback:function(){e.$router.push("/index")}}]})},StandardPost:function(t,e){var i=document.createElement("form");i.id="aliPay",i.methods="post",i.action=t,i.target="_self";var s=[];for(var a in e)s[a]=document.createElement("input"),s[a].type="hidden",s[a].name=a,s[a].value=e[a],i.appendChild(s[a]);i.addEventListener("submit",function(){},!1),document.body.appendChild(i),i.dispatchEvent(new Event("submit")),i.submit(),document.body.removeChild(i)},completed:function(){this.popShow=!1,1==this.type?this.$router.replace({path:"/payresult",query:{order_id:this.ids}}):this.$router.replace({path:"/balance"})},heavyLoad:function(){this.popShow=!1,this.$router.replace({path:"/cashierdesk",query:{ids:this.ids,type:this.type}})}},watch:{}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cashierdesk"},[i("yd-cell-group",[i("yd-cell-item",[i("span",{attrs:{slot:"left"},slot:"left"},[t._v("订单类型")]),t._v(" "),i("span",{attrs:{slot:"right"},domProps:{innerHTML:t._s(1==t.type?"商品订单":"充值订单")},slot:"right"})]),t._v(" "),1==t.type?i("yd-cell-item",[i("span",{attrs:{slot:"left"},slot:"left"},[t._v("订单编号")]),t._v(" "),i("span",{attrs:{slot:"right"},slot:"right"},[t._v(t._s(t.ids))])]):t._e(),t._v(" "),i("yd-cell-item",[i("span",{attrs:{slot:"left"},slot:"left"},[t._v("订单金额")]),t._v(" "),i("span",{attrs:{slot:"right"},slot:"right"},[t._v("￥"+t._s(t.money))])])],1),t._v(" "),i("payment",{attrs:{payments:t.payments,money:t.userInfo.balance},on:{pay:t.pay}}),t._v(" "),i("yd-popup",{staticClass:"payresult",attrs:{position:"center",width:"70%","close-on-masker":!1},model:{value:t.popShow,callback:function(e){t.popShow=e},expression:"popShow"}},[i("div",[i("div",{staticClass:"payresult-i"},[t._v("请确认微信支付是否已完成")]),t._v(" "),i("div",{staticClass:"payresult-i",on:{click:t.completed}},[t._v("已完成支付")]),t._v(" "),i("div",{staticClass:"payresult-i",on:{click:t.heavyLoad}},[t._v("支付遇到问题,重新支付")])])])],1)},staticRenderFns:[]};var o=i("C7Lr")(n,r,!1,function(t){i("4VUU")},null,null);e.default=o.exports},"Zw/p":function(t,e){}});
//# sourceMappingURL=21.e5f3da845538de1040b6.js.map